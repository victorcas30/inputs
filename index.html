<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seleccionar imagen o tomar foto</title>
</head>
<body>

  <h1>Seleccionar imagen o tomar foto</h1>

  <!-- Botón para seleccionar imágenes de la galería -->
  <input type="file" id="inputImagen" accept="image/*" style="display: none;">
  <button id="botonSeleccionarImagen">Seleccionar desde la Galería</button>

  <!-- Botón para tomar una foto -->
  <button id="botonTomarFoto">Tomar Foto</button>

  <!-- Elemento para mostrar la imagen seleccionada o tomada -->
  <img id="imagenMostrada" style="display: none;">

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Referencias a los elementos del DOM
      var inputImagen = document.getElementById('inputImagen');
      var botonSeleccionarImagen = document.getElementById('botonSeleccionarImagen');
      var botonTomarFoto = document.getElementById('botonTomarFoto');
      var imagenMostrada = document.getElementById('imagenMostrada');

      // Evento cuando se hace clic en el botón para seleccionar desde la galería
      botonSeleccionarImagen.addEventListener('click', function () {
        inputImagen.click();
      });

      // Evento cuando se selecciona una imagen de la galería o se toma una foto
      inputImagen.addEventListener('change', function (event) {
        var archivo = event.target.files[0];
        if (archivo) {
          mostrarImagen(archivo);
        }
      });

      // Evento cuando se hace clic en el botón para tomar foto
      botonTomarFoto.addEventListener('click', function () {
        abrirCamara();
      });

      // Función para mostrar la imagen seleccionada o tomada
      function mostrarImagen(archivo) {
        var lector = new FileReader();
        lector.onload = function (e) {
          imagenMostrada.src = e.target.result;
          imagenMostrada.style.display = 'block';
        };
        lector.readAsDataURL(archivo);
      }

      // Función para abrir la cámara y permitir al usuario tomar una foto
      function abrirCamara() {
        navigator.mediaDevices.getUserMedia({ video: true })
          .then(function (stream) {
            var video = document.createElement('video');
            document.body.appendChild(video);
            video.srcObject = stream;
            video.play();

            video.addEventListener('canplay', function () {
              var canvas = document.createElement('canvas');
              canvas.width = video.videoWidth;
              canvas.height = video.videoHeight;
              canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
              mostrarImagen(canvas.toDataURL('image/png'));

              // Detener la transmisión de la cámara
              stream.getTracks().forEach(track => track.stop());

              // Eliminar el elemento de video
              document.body.removeChild(video);
            });
          })
          .catch(function (error) {
            console.error('Error al acceder a la cámara: ', error);
          });
      }
    });
  </script>

</body>
</html>
